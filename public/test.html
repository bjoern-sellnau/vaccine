<!DOCTYPE html>
<html>
  <head>
    <title>Vaccine.js</title>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:800" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="/easydemo.css">
    <link rel="stylesheet" type="text/css" href="/styles.css">
  </head>
  <body>
    <div id="dim-background"></div>
    <a style="position: absolute; left: -12px; top: -12px; border: 0;" href="https://github.com/jakesandlund/vaccine"><img src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png" alt="Fork me on GitHub"></a>
    <header><h1 class="structure">Vaccine.js</h1></header>
    <div id="sizes-container">
      <div id="sizes" class="structure">
        <div class="shot-container">
          <img class="shot" src="/shot.png" alt="Vaccine shot">
          <div class="shot current"></div>
          <div class="shot saved"></div>
        </div>
        <div id="size-info" class="info">
          <div class="variable-sizes"></div>
          <a class="open-help"><div>?</div></a>
        </div>
      </div>
    </div>
    <div id="base" class="structure">
      <div id="config" class="configuration">
        <div class="divider">
          <h3>Project Settings</h3>
        </div>
        <div id="format" class="group">
          <a class="open-help"><div>?</div></a>
          <div class="title">Module Format <span class="hint">(set first)</span></div>
          <div class="inputs">
            <div id="amd" class="format-picker"><input type="button" value="AMD"></div>
            <div id="commonjs" class="format-picker"><input type="button" value="CommonJS"></div>
            <div id="umd" class="format-picker"><input type="button" value="UMD"></div>
            <input type="hidden" name="format">
          </div>
        </div>
        <div id="supports" class="group">
          <a class="open-help"><div>?</div></a>
          <div class="title">Support <span class="hint">these environments</span></div>
          <div class="inputs">
            <label><input type="checkbox" name="supports" value="window">Global (window)</label>
            <label><input type="checkbox" name="supports" value="amd">AMD</label>
            <label><input type="checkbox" name="supports" value="commonjs">CommonJS</label>
          </div>
        </div>
        <div class="group" id="variables">
          <a class="open-help"><div>?</div></a>
          <div class="title">Project Variables</div>
          <div class="inputs">
            <label>Name<input type="text" name="name"></label>
            <label>Dependencies<input type="text" name="dependencies"></label>
            <label id="entry-file">Main (entry file)<input type="text" name="main"></label>
          </div>
        </div>
        <div class="divider">
          <h3>Optimizations</h3>
        </div>
        <div id="require" class="group">
          <a class="open-help"><div>?</div></a>
          <div class="title">Require <span class="hint">other modules</span></div>
          <div class="inputs">
            <label><input type="checkbox" name="require" value="full">full relative</label>
            <label><input type="checkbox" name="require" value="single">single relative ("./module")</label>
            <label id="absolute-id"><input type="checkbox" name="require" value="absolute">absolute id ("my_lib/module")</label>
            <label id="w-o-index"><input type="checkbox" name="require" value="index">w/o index ("pkg/index" -&gt; "pkg")</label>
          </div>
        </div>
        <div id="exports" class="group">
          <a class="open-help"><div>?</div></a>
          <div class="title">Export <span class="hint">a module's API</span></div>
          <div class="inputs">
            <label><input type="checkbox" name="exports" value="exports">exports</label>
            <label><input type="checkbox" name="exports" value="module">module.exports</label>
            <label id="export-return"><input type="checkbox" name="exports" value="return">return</label>
          </div>
        </div>
        <div id="define" class="group">
          <a class="open-help"><div>?</div></a>
          <div class="title">Define <span class="hint">an AMD module</span></div>
          <div class="inputs">
            <label><input type="checkbox" name="define" value="optional_id">optional id ("define(id?, ...)")</label>
            <label><input type="checkbox" name="define" value="array" disabled="disabled">array ("define([requires], ...)")</label>
          </div>
        </div>
        <div class="divider">
          <h3>Miscellaneous</h3>
        </div>
        <div id="debugging" class="group">
          <a class="open-help"><div>?</div></a>
          <div class="title">Debugging</div>
          <div class="inputs">
            <label><input type="checkbox" name="debugging" value="debug">debug</label>
            <label><input type="checkbox" name="debugging" value="performance">performance</label>
            <label><input type="checkbox" name="debugging" value="use_strict">"use strict";</label>
          </div>
        </div>
        <div id="variable-overrides" class="group">
          <a class="open-help"><div>?</div></a>
          <div class="title">Variable Overrides</div>
          <div class="inputs">
            <label id="source-directory">Source directory<input type="text" name="src"></label>
            <label>Global variable name<input type="text" name="global"></label>
          </div>
        </div>
      </div>


      <div id="help-document">
        <div class="close">&times;</div>
        <h2>Vaccine.js - Help - <input id="show-demo" type="button" value="Show Demo"></h2>
        <div class="content">

<div id="h-start" class="help-section">
  <div class="title">Help Start</div>
  A good introduction to Vaccine is the demo. Click the above button to see it.
</div>
<div id="h-size-info" class="help-section">
  <div class="title">Size Info</div>
  <p>When in Diff mode, the numbers are the difference between the configurations
  under comparison. When red, the current configuration is smaller (showing
  bytes removed). When green, the current configuration is larger (showing
  bytes added).</p>

  <p>The bytes minified are calculated by running
  <a href="https://github.com/mishoo/UglifyJS">UglifyJS</a> on the text of
  <code>vaccine.js</code> wrapped in an immediately evaluated function
  <code>(function() { ... }())</code>.</p>

  <p>Gzipped size was calculated by gzipping various vaccine.js versions with a
  4.8k sized library. A linear regression fit the resulting gzipped sizes
  with a 0.997 correlation coefficient. Note that when compressing with
  smaller libraries, the amount added tends to be more.</p>
</div>
<div class="divider">
  <h3>Project Settings</h3>
</div>
<div id="h-format" class="help-section">
  <div class="title">Module Format</div>
  To use Vaccine, the JavaScript files must be written in one of the following
  three module formats. Click the links for more info about each format. Set
  the module format before any other options are set, since it will hide
  options that don't work with the chosen format. Clicking the buttons will
  also set all options back to the default.
  <ul>
    <li><span class="key"><a href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD</a></span>
    - AMD requires a build step with <code>sh build.sh &gt; library.js</code>.
    An AMD module is written with a call to <code>define</code>. Currently, the
    supported method signature is <code>define(id?, factory)</code>. The
    factory parameters are <code>factory(require, exports?, module?)</code>
    with the last two depending on the <a href="#help-exports">exports</a>
    configuration.</li>

    <li><span class="key"><a href="http://wiki.commonjs.org/wiki/Modules/1.1">CommonJS</a></span>
    - CommonJS requires a build step with <code>sh build.sh &gt; library.js</code>.
    The format is very similar to the inside of the <code>factory</code> of an
    AMD module. There are three free variables: <code>require, exports, and
    module</code>.
    </li>

    <li><span class="key"><a href="https://github.com/umdjs/umd">UMD</a></span>
    - UMD is a pattern for a single file to support multiple environments, such
    as CommonJS, AMD, or a regular browser global. It does not need a build.
    </li>
  </ul>
</div>
<div id="h-supports" class="help-section">
  <div class="title">Environments Supported</div>
  These options determine what environments the project will support.
  Some formats cannot work in some environments, so they will be marked in red.
  <ul>
    <li><span class="key">Global (window)</span> - This is the standard method
    of creating a single global variable for a library (or application). Then,
    any code that uses this library will have access via the global
    variable.</li>
    <li><span class="key">AMD</span> - This option means that the library will
    work in any application that uses an AMD module loader, such as RequireJS.
    That is, this option adds a <code>define('library_name', factory)</code> if
    AMD is detected.</li>
    <li><span class="key">CommonJS</span> - This option means that the project
    will support CommonJS environments, such as
    <a href="http://nodejs.org">Node.js</a>.</li>
  </ul>
</div>
<div id="h-variables" class="help-section">
  <div class="title">Project Variables</div>
  These variables are used to configure the shim to work for the project.
  <ul>
    <li><span class="key">Name</span> - The name of the project. The global
    variable as well as the AMD module id will be set to this.</li>
    <li><span class="key">Dependencies</span> - The names of the library's
    dependencies. This will be used if supporting an AMD environment, with the
    <code>define</code> call.</li>
    <li><span class="key">Main (entry file)</span> - The relative path of the
    main file from the project's root directory. For built libraries (AMD,
    CommonJS), all the source files must be in a separate directory with only
    sources. This source directory is extracted from the path to the main file,
    but can be overwritten with a
    <a href="#help-variable-overrides">variable override</a>.</li>
  </ul>
</div>
<div class="divider">
  <h3>Optimizations</h3>
</div>
<div id="h-require" class="help-section">
  <div class="title">Require</div>
  The require options set how a module will obtain the exports from a module
  it depends on. For example, assuming a source directory of "src", the
  "src/a.js" module could get the exports from "src/b.js" by doing a
  <code>var b = require('./b')</code>. Note the lack of a ".js" at the end
  of the id string. This must be left out to work. Certain projects have only
  one level of code, which means they can use simpler "require" functionality.
  <ul>
    <li><span class="key">full relative</span> - A full "require" implementation
    that supports complex relative require's such as
    <code>require('../../module.js')</code>. It also supports a single relative
    or absolute id, which is why those options don't do anything when this
    one is checked.
    </li>
    <li><span class="key">single relative</span> - A simple single directory
    require of the format <code>require('./{{module}}')</code>. This means
    a file at "src/a.js" could require "src/b.js" with <code>require('./b')</code>,
    but it wouldn't be able to require "src/some_dir/c.js" with just this
    option checked.
    </li>
    <li><span class="key">absolute id</span> - Require a module with the full
    AMD path (which doesn't include the source directory). For example, the
    "src/my_lib.js" file could require "src/my_lib/utils.js" with
    <code>require('my_lib/utils')</code>. Note the lack of a "./" or "../" at
    the beginning signifying that this is an absolute path. This option is
    only available to the AMD format.
    </li>
    <li><span class="key">w/o index</span> - This means that the "/index" is
    left off the end of requiring an "index.js" module. So, for example,
    module "src/foo.js" must require "src/utils/index.js" with
    <code>require('./utils')</code>. Note that the module can not also be
    required with the "/index" at the end, so beware. This only works
    for CommonJS format with a full relative implementation.
    </li>
  </ul>
</div>
<div id="h-exports" class="help-section">
  <div class="title">Exports</div>
  The export options decide how a module can export its API.
  <ul>
    <li><span class="key">exports</span> - Export via attaching properties to
    the exports object (free variable for CommonJS; second factory parameter
    for AMD). A module can export a "foo" method via <code>exports.foo = ...
    </code>. The exports object becomes the module's API.
    </li>
    <li><span class="key">module.exports</span> - Export via setting
    module.exports with the module's API. If, for example, "bar.js" wanted to
    have a function as the API, it could
    <code>module.exports = function() ...</code>. Then, another module could
    <code>var bar = require('./bar'); ... bar()</code> to run the function.
    </li>
    <li><span class="key">return</span> - Export the API via returning an
    object from the AMD factory. This only works for AMD.
    </li>
  </ul>
</div>
<div id="h-define" class="help-section">
  <div class="title">Define</div>
  This section is AMD only. It sets how the "define" call operates.
  <ul>
    <li><span class="key">optional id</span> - This option makes it possible
    to leave out the module id in the "define" call, so:
    <code>define(factory)</code>. It makes the build step (build.sh) slightly
    more complex, but saves some typing. When unchecked, the module id must
    be included: <code>define(id, factory)</code>.
    </li>
    <li><span class="key">array</span> - This option hasn't been implemented
    yet, but is there to signify that the dependency array in the "define"
    call is not supported.
    </li>
  </ul>
</div>
<div class="divider">
  <h3>Miscellaneous</h3>
</div>
<div id="h-debugging" class="help-section">
  <div class="title">Debugging</div>
  These options add some helpful debugging.
  <ul>
    <li><span class="key">debug</span> - Logs different actions to the
    console, such as when a module is defined or required. It also throws
    an error if a module is redefined, or required but never defined.
    </li>
    <li><span class="key">performance</span> - Calculates the time it takes
    to define all the modules and run their factories.
    </li>
    <li><span class="key">"use strict";</span> - Adds a "use strict" into
    the built library to enable strict mode.
    </li>
  </ul>
</div>
<div id="h-variable-overrides" class="help-section">
  <div class="title">Variable Overrides</div>
  These options override the settings derived from the
  <a href="#help-variables">project variables</a>.
  <ul>
    <li><span class="key">Source directory</span> - Sets the source directory
    used in "build.sh".
    </li>
    <li><span class="key">Global variable name</span> - Sets the name of
    the global variable when supporting that
    <a href="#help-supports">environment</a>.
    </li>
  </ul>
</div>
<div id="h-controls" class="help-section">
  <div class="title">Controls</div>
  These controls add the ability to save or compare different shim
  configurations.
  <ul>
    <li><span class="key">Save</span>
    </li>
    <li><span class="key">Swap</span>
    </li>
    <li><span class="key">Diff with saved</span>
    </li>
  </ul>
</div>
<div id="h-targets" class="divider">
  <h3>Targets</h3>
</div>
<div id="h-vaccine-js" class="help-section">
  <div class="title">vaccine.js</div>
</div>
<div id="h-build-sh" class="help-section">
  <div class="title">build.sh</div>
</div>
<div id="h-vaccine_dev-js" class="help-section">
  <div class="title">vaccine_dev.js</div>
</div>
<div id="h-dev_server-js" class="help-section">
  <div class="title">dev_server.js</div>
</div>
<div id="h-Makefile" class="help-section">
  <div class="title">Makefile</div>
</div>
<div id="h-umd-js" class="help-section">
  <div class="title">umd.js</div>
</div>

        </div>
      </div>


      <div id="demo-text">


<p>Vaccine helps improve modularity by enabling JavaScript libraries to use a
<a href="http://wiki.commonjs.org/wiki/Modules/1.1">CommonJS</a>
(<a href="http://nodejs.org/api/modules.html">Node.js</a>) or
<a href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD</a> module format and
work in both browser and server. (These formats try to remedy JavaScript's lack
of modules, so using them produces more modular code.) Vaccine works by
generating a small shim that gets built with the project's code to make it
function in a single script tag.</p>

<p>The shim is configurable, which decreases its <signal>size</signal> by
including only the required functionality. Many libraries need to work in both
server and client, and Vaccine makes it easy for them to do so. Now the library
can be written in the server's native CommonJS format and still work in the
browser. The tiny size of the shim makes this feasible for the many small
JavaScript libraries.</p>

<p>The best example of reducing size via configuration is for projects
that have only one directory of source files (no subdirectories). Having one
level of sources simplifies the require implementation considerably.</p>

<p>To use Vaccine, first set the options in the <signal>left panel</signal>.
The <signal>shim</signal> will <strong>instantly adjust</strong> to
changes.</p>

<p>All options can be selected in any combination. However, certain
combinations of options do not work, and are marked in red. A <signal>fix
it</signal> link can be used to correct the problem.</p>

<p>Set the project's <signal>module format</signal> and then choose what
environments the project will <signal>support</signal>.</p>

<p>Enter your project's <signal>name</signal>, <signal>main file</signal>,
and <signal>dependencies</signal> to make the shim work for your project.</p>

<p><signal>Optimize</signal> the shim size by checking only the necessary
functionality.</p>

<p>Use the <signal>diff button</signal> to compare between the current
and <signal>saved</signal> configuration. The <signal>size</signal> shows
the amount added or removed.</p>

<p>
After setting the options as desired, copy <signal>vaccine.js</signal> and
<signal>build.sh</signal> to your project's root directory. When you are ready to
build, run <code>sh build.sh &gt; my_built_file.js</code>. Note that all
source code, and only source code, must be in a separate directory for the
tiny build script to work.</p>

<p>Use the <a href="https://github.com/umdjs/umd">UMD</a> <signal>format</signal>
for single file projects&mdash;no build required.</p>

<p>For development, the <signal>vaccine_dev.js</signal> version can be placed
before script tags for all the modules (in any order). Call
<code>requireDev()</code> to get the project's global.</p>

<p>The name "vaccine" comes from the analogy that the shims are injected into
the code like the virus used in a vaccine, and that they are
a temporary treatment until the
<a href="http://wiki.ecmascript.org/doku.php?id=harmony:modules">Harmony modules</a>
"cure" arrives.
</p>

<p>For help with any of the options, and for other info, click on the
<signal>question mark</signal> icons to display the help.</p>
      </div>
      <div id="main">
        <div class="configuration">
          <div id="controls">
            <input id="save" type="button" value="Save">
            <input id="swap" type="button" value="Swap">
            <div class="button" id="diff"><em>Diff</em> with saved</div>
            <a class="open-help"><div>?</div></a>
          </div>
          <div id="targets" class="group">
            <div class="inputs">
              <label class="target-non-umd"><input type="checkbox" name="targets" value="vaccine.js">vaccine.js</label>
              <label id="target-umd"><input type="checkbox" name="targets" value="umd.js">umd.js</label>
              <label class="target-non-umd"><input type="checkbox" name="targets" value="build.sh">build.sh</label>
              <label class="target-non-umd"><input type="checkbox" name="targets" value="vaccine_dev.js">vaccine_dev.js</label>
              <label class="target-non-umd"><input type="checkbox" name="targets" value="dev_server.js">dev_server.js</label>
              <label class="target-non-umd"><input type="checkbox" name="targets" value="Makefile">Makefile</label>
            </div>
            <div class="title"></div>
            <a class="open-help"><div>?</div></a>
          </div>
        </div>
        <div id="sources"></div>
      </div>
    </div>
    <div class="clear"></div>
    <footer>Copyright 2012 <a href="http://jakesandlund.com">Jake Sandlund</a></footer>

    <script src="/d3.js"></script>

    <!-- DEVELOPMENT -->
    <script src="/vaccine_dev.js"></script>
    <script src="/src/consolidator.js"></script>
    <script src="/src/demo.js"></script>
    <script src="/src/easydemo.js"></script>
    <script src="/src/hijs.js"></script>
    <script src="/src/jsdiff.js"></script>
    <script src="/src/parse-js.js"></script>
    <script src="/src/process.js"></script>
    <script src="/src/templates.js"></script>
    <script src="/src/uglify-js.js"></script>
    <script src="/src/vaccine.js"></script>
    <script src="/src/web.js"></script>
    <script>requireDev();</script>
    <!-- /DEVELOPMENT -->
    <!-- PRODUCTION -->

  </body>
</html>
